<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editable Table with JSON Import/Export</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        button {
            margin: 5px;
            padding: 10px 15px;
            font-size: 14px;
            border: none;
            border-radius: 4px;
            background-color: #007BFF;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        textarea {
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: white;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #007BFF;
            color: white;
        }
        .charCount {
            text-align: center;
            font-weight: bold;
            color: #555;
        }
        .narrow-column {
            width: 20ch;
        }
    </style>
</head>
<body>
    <h1>Coursework submission form preparation</h1>
    <input id="cisUsername" placeholder="Enter CIS Username" style="width: 100%; margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
    <textarea id="globalTextarea" maxlength="1000" placeholder="Enter up to 1000 characters..." style="width: 100%; height: 100px;"></textarea>
    <button id="addRowButton">Add Row</button>
    <button id="downloadJsonButton">Download JSON</button>
    <input type="file" id="uploadJsonInput" accept="application/json" style="display: none;">
    <button id="uploadJsonButton">Upload JSON</button>
    <button id="validateHashesButton">Validate Flags</button>
    <table id="editableTable">
        <thead>
            <tr>
                <th class="narrow-column">Flag</th>
                <th>Explanation</th>
                <th>Character Count</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        const tableBody = document.querySelector('#editableTable tbody');
        const addRowButton = document.getElementById('addRowButton');
        const downloadJsonButton = document.getElementById('downloadJsonButton');
        const uploadJsonButton = document.getElementById('uploadJsonButton');
        const uploadJsonInput = document.getElementById('uploadJsonInput');
        const validateHashesButton = document.getElementById('validateHashesButton');

        const valid_hashes = []; // Populate this list with valid MD5 hashes

        function md5(value) {
            // Simple MD5 function (use a library like crypto.js for real-world use)
            return CryptoJS.MD5(value).toString();
        }

        function updateCharacterCount(row) {
            const textarea = row.querySelector('textarea');
            const charCountCell = row.querySelector('.charCount');
            charCountCell.textContent = `${textarea.value.length} / 200`;
        }

        function createRow(textValue = '', textareaValue = '') {
            const row = document.createElement('tr');

            const textCell = document.createElement('td');
            const textInput = document.createElement('input');
            textInput.type = 'text';
            textInput.value = textValue;
            textInput.style.width = '100%';
            textCell.appendChild(textInput);

            const textareaCell = document.createElement('td');
            const textarea = document.createElement('textarea');
            textarea.maxLength = 200;
            textarea.value = textareaValue;
            textarea.style.width="90%";
            textarea.addEventListener('input', () => updateCharacterCount(row));
            textareaCell.appendChild(textarea);

            const charCountCell = document.createElement('td');
            charCountCell.className = 'charCount';
            charCountCell.textContent = `${textareaValue.length} / 200`;

            const actionsCell = document.createElement('td');
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.onclick = () => row.remove();
            actionsCell.appendChild(deleteButton);

            row.appendChild(textCell);
            row.appendChild(textareaCell);
            row.appendChild(charCountCell);
            row.appendChild(actionsCell);

            tableBody.appendChild(row);
        }

        addRowButton.addEventListener('click', () => createRow());

        downloadJsonButton.addEventListener('click', () => {
            const rows = Array.from(tableBody.querySelectorAll('tr'));
            const data = rows.map(row => {
                const textValue = row.querySelector('input').value;
                const textareaValue = row.querySelector('textarea').value;
                return { flag: textValue, description: textareaValue };
            });
            output = {}
            output["cisUsername"] = document.getElementById('cisUsername').value;
            output["globalTextarea"] = document.getElementById('globalTextarea').value;
            output["flags"] = data;
            const blob = new Blob([JSON.stringify(output, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `submission_COMP2211_${output["cisUsername"]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        });

        uploadJsonButton.addEventListener('click', () => uploadJsonInput.click());

        uploadJsonInput.addEventListener('change', event => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const data = JSON.parse(e.target.result);
                    tableBody.innerHTML = '';
                    data.forEach(row => createRow(row.text, row.textarea));
                };
                reader.readAsText(file);
            }
        });

        validateHashesButton.addEventListener('click', () => {
            const rows = Array.from(tableBody.querySelectorAll('tr'));
            rows.forEach(row => {
                const textValue = row.querySelector('input').value;
                const hash = md5(textValue);
                if (valid_hashes.includes(hash)) {
                    row.style.backgroundColor = '#d4edda'; // Green for valid
                } else {
                    row.style.backgroundColor = '#f8d7da'; // Red for invalid
                }
            });
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</body>
</html>
